<!DOCTYPE html>
<html>

<head>
	<title>Create Coping Card</title>

	<meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" media="screen" href="../style/bootstrap/css/bootstrap.min.css">
<!--         <link rel="stylesheet" type="text/css" href="../holo/holo-base-elements.css" />
    <link rel="stylesheet" type="text/css" href="../holo/holo-light-elements.css" />
    <link rel="stylesheet" type="text/css" href="../holo/holo-base-widgets.css" />
    <link rel="stylesheet" type="text/css" href="../holo/holo-light-widgets.css" /> -->
      <link rel="stylesheet" media="screen" href="../style/font-awesome/css/font-awesome.min.css">
        <link rel="stylesheet" media="screen" href="../js/vendor/tourist.css">
    <link rel="stylesheet" media="screen" href="../js/vendor/jquery.qtip.min.css">


  <script src="../js/vendor/jquery-2.0.3.min.js"></script>
  <script src="../js/vendor/date.js"></script>
  <script src="../js/vendor/lodash.min.js"></script>
  <script src="../js/vendor/async.js"></script>
  <script src="../style/bootstrap/js/bootstrap.min.js"></script>
  <script src="../js/cbits.js"></script>
  <script src="../js/vendor/backbone-min.js"></script>
  <script src="../js/vendor/tourist.min.js"></script>
    <script src="../js/vendor/jquery.qtip.min.js"></script>


	<script type="text/javascript">

		$(document).ready(function() {

      var c = new Date();
      $("#evtDate").val(c.toString('yyyy-MM-dd'));
      $("#evtTime").val(c.toString('HH:mm'));

      $("input.gray")
        .css('color','LightGray')
        .click(function() {
          if($(this).val() == testTitle) { clearContents($(this)); }
        })
        .blur(function() {
          if($(this).val().length == 0) { $(this).val(testTitle); }
        })
      ;
      $("textarea.gray")
        .css('color','LightGray')
        .focus(function() {
          if($(this).text() == testText) { clearContents($(this)); }
        })
        .blur(function() {
          if($(this).text().length == 0) { $(this).text(testText); }
        })
        ;

			
      /**
       * On save button click...
       * @return {[type]} [description]
       */
			$("[name='save']").click(function() {

        // assign trigger parameter values
				var startDateTime = html5DateAndTimeToJSDateTime($("#evtDate").val(), $("#evtTime").val());
				var id = triggerIdCommonPrefix + startDateTime.toICal(),
						name = id;
				var repeatStr = 'FREQ=MINUTELY;COUNT=1',
						endDateTime = startDateTime.clone().addMinutes(1);
				
        // assign values to showNativeDialog parameters
        var showNativeDialogParams = getQuotedAndDelimitedStr([
          $("#evtTitle").val(), $("#evtMsg").val(), 'Yes/OK', 'No/Cancel', 'PurpleRobot.deleteTrigger(\\"' + id + '\\");', 'PurpleRobot.deleteTrigger(\\"' + id + '\\");'
          ], ',', '"');
        var action =
					'PurpleRobot.showNativeDialog(' + showNativeDialogParams + ');'
          // 'PurpleRobot.playDefaultTone();' 
					;

        // create trigger object
				var triggerObj = {
	        'identifier': id,
	        'type': 'datetime',
	        'name': name,
	        'action': ''
	          // + 'PurpleRobot.log("[IN TRIGGER ACTION]);'
	          + action
	          // + 'PurpleRobot.log("[IN TRIGGER ACTION]);'
	        ,
	        'datetime_start': startDateTime.toICal(),
	        'datetime_end': endDateTime.toICal(),
	        'datetime_repeat': repeatStr
	      };


				// POST trigger obj to PR				
        var postData = JSON.stringify({
          "command": "execute_script",
          "script": 'PurpleRobot.updateTrigger("' + triggerObj.identifier + '", ' + JSON.stringify(triggerObj) + ');'
        });
				console.log('postData = ', postData);
				
        $.post(prJsonSubmitUrl, { "json": postData })
					.done(function(resData) {
						console.log('Posted to '+  prJsonSubmitUrl + '; response data = ', resData);
						// window.location.href = 'copingCardView.html';
            
            // hide the save button and notify the user of the save status.
            $("#saveButton").hide();
            $("#saveMsgStatus")
              .text('Save successful!')
              .removeClass('error').removeClass('none').addClass('noerror')
              ;
            $("#saveMsg").show();

            // after 3 seconds, display the save button again.
            setTimeout(function() {
              $("#saveButton").show();
              $("#saveMsgStatus")
                .text('')
                .removeClass('error').removeClass('noerror').addClass('none')
                ;
              $("#saveMsg").hide();

            }, 3000);
					});

          window.location.href="index.html"

			});

		});

	</script>

</head>


<body>
	<div class="row-fluid">
		<div class="col-md-1"></div>

		<div class="col-md-10">
			<h3><a href="index.html"><i class="icon-chevron-left"></i> </a>Create Coping Card</h3>
			<p class="alert alert-info"><b>Remember:</b> This is all about planning for the future. Try to pick something important that you often avoid!</p>
			<form id="edit-event" class="form-group" name="edit-event" action="index.html">
				<input id="evtTitle" name="evtTitle" type="text" style="width:100%;" placeholder="Write something you'll remember!"/><br />
				<br />
				<textarea id="evtMsg" name="evtMsg" rows="4" cols="50"  style="width:100%;"  placeholder="What do you want to remind yourself of when this happens?"></textarea><br />
				<br />
				Schedule your reminder for:<br/><input id="evtDate" name="evtDate" type="date"  style="width:100%;" /><br/><input id="evtTime" name="evtTime" type="time"  style="width:100%;"/><br />
			</form>

      <div id="saving" class="span12">
  		  <div id="saveButton"><input class="btn btn-primary" name="save" type="submit" value="Save" /></div>
        <div id="saveMsg" style="display:none;"><span id="saveMsgStatus" class="span11 bold postResponse none"></span></div>
      </div>

    </div>
	
		<div class="col-md-1"></div>

	</div>
</body>

</html>